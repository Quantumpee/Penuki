<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Penuki ‚Äî Puppy Care Game</title>
<style>
  :root{
    --bg1:#ffe7f1;
    --bg2:#e6f8ff;
    --accent:#ff8ac5;
    --accent-2:#7ee0ff;
    --accent-3:#ffd66b;
    --good:#4cc780;
    --ok:#ffb84d;
    --bad:#ff6b6b;
    --ink:#3b2c35;
    --panel:#ffffffee;
    --shadow: 0 10px 25px rgba(0,0,0,.12);
  }
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    color:var(--ink);
    background: radial-gradient(1200px 600px at 10% -10%, var(--bg1), transparent 60%),
                radial-gradient(1200px 600px at 110% -20%, var(--bg2), transparent 60%),
                linear-gradient(180deg,#fff, #fff9);
  }
  .wrap{ display:grid; grid-template-rows:auto 1fr auto; min-height:100%; }

  /* HUD */
  .hud{
    position:sticky; top:0; z-index:10;
    padding:10px clamp(12px,2vw,24px);
    background:linear-gradient(180deg,#fff,#fff9);
    border-bottom:1px solid #00000010;
    backdrop-filter:saturate(1.1) blur(6px);
  }
  .title-row{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
  .logo{ display:inline-grid; place-items:center; width:42px; height:42px; border-radius:14px;
    background: conic-gradient(from 180deg, var(--accent), var(--accent-2), var(--accent-3), var(--accent));
    box-shadow: var(--shadow); color:#fff; font-size:22px; font-weight:900; }
  h1{ font-size: clamp(20px, 3vw, 28px); margin:0 }
  .sub{opacity:.7; font-weight:600; font-size:.9rem}

  /* SCORES: auto-wrap grid so it never overlaps */
  .scores{
    margin-top:10px; display:grid; gap:10px;
    /* Key line: auto-fit with a sensible min size so we wrap to 2 rows on phones */
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }
  /* Ultra-narrow phones: shrink cards a bit more */
  @media (max-width: 360px){
    .scores{ grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:8px; }
    .card{ padding:8px 10px; }
  }
  /* Compact mode: hide words, keep emoji + number so we stay one line if needed */
  @media (max-width: 330px){
    .tag{ gap:4px; }
    .tag::after{ content:""; } /* no extra text */
    .tag .label{ display:none; } /* hide the label text */
  }

  .card{
    background:var(--panel); border-radius:14px; box-shadow: var(--shadow);
    padding:10px 12px; display:grid; gap:6px;
  }
  .card .row{ display:flex; align-items:center; gap:8px; justify-content:space-between }
  .tag{
    display:inline-flex; align-items:center; gap:6px; font-weight:700;
    padding:4px 8px; border-radius:999px; background:#00000008;
  }
  .tag .em{font-size:1.1rem}
  .num{ font-weight:800; min-width:2ch; text-align:right; }
  .bar{ height:10px; background:#0000000f; border-radius:999px; overflow:hidden; position:relative; }
  .fill{ --p: 1; width:calc(var(--p)*1%); height:100%; border-radius:inherit; transition: width .25s ease; }
  .fill.feed { background: linear-gradient(90deg, #ff99c2, #ff6b9e); }
  .fill.play { background: linear-gradient(90deg, #7ee0ff, #43b5ff); }
  .fill.pet  { background: linear-gradient(90deg, #ffd66b, #ff9f1a); }
  .fill.avg  { background: linear-gradient(90deg, #4cc780, #43dd99); }

  /* Stage */
  .stage{ position:relative; display:grid; place-items:center; padding:10px clamp(12px,2vw,24px); }
  .stage-inner{
    width:min(1100px, 96vw); aspect-ratio:16/9;
    background: radial-gradient(60% 70% at 50% 15%, #ffffff, #fff6),
                linear-gradient(180deg, #d7f7ff 0 60%, #c7f3c9 60% 100%);
    border-radius:22px; overflow:hidden; box-shadow: var(--shadow); position:relative;
  }
  .moodTint{ position:absolute; inset:0; pointer-events:none; mix-blend-mode:multiply; opacity:.0;
    background: radial-gradient(120% 100% at 50% -20%, transparent 50%, rgba(255,0,0,.12));
    transition: opacity .4s ease; }
  .puppy-wrap{ position:absolute; inset:0; display:grid; place-items:center; padding-top:min(5vh,30px); }
  svg{ max-width:100%; height:auto; display:block }

  /* Puppy animations */
  .tail{ transform-origin: left center; }
  @keyframes wag { from { transform: rotate(10deg);} 50%{ transform: rotate(-18deg);} to{ transform: rotate(10deg);} }
  .wag{ animation: wag var(--wag, .8s) infinite ease-in-out; }

  /* Controls */
  .controls{
    position:relative; padding:18px clamp(12px,2vw,24px) 28px;
    background: linear-gradient(180deg, #ffffff, #fff8);
    border-top:1px solid #00000010; display:grid; gap:14px;
    overscroll-behavior: contain; /* keep scroll from stealing drags */
  }
  .pad-grid{ display:grid; gap:14px; grid-template-columns: repeat(3, minmax(0,1fr)); }
  .pad{
    background:var(--panel); border-radius:18px; padding:12px; box-shadow: var(--shadow);
    display:grid; gap:10px; align-content:start; position:relative; overflow:visible;
  }
  .pad h3 { margin:0; font-size:1rem; display:flex; align-items:center; gap:8px }
  .pad .hint{ font-size:.85rem; opacity:.7 }
  .playground{ position:relative; min-height:84px; display:grid; place-items:center; overflow:visible }

  /* Draggables / Clickables */
  .bowl, .ball, .heart-btn{
    user-select:none; -webkit-user-drag:none; touch-action:none; cursor:grab;
    transition: transform .15s ease;
  }
  .ball, .heart-btn{ cursor:pointer }
  .dragging{ cursor:grabbing; transform: scale(1.06); }
  .returning{ transition: transform .5s cubic-bezier(.16,1,.3,1); }
  .float{ position:absolute; left:0; top:0; will-change:transform }

  /* Follow-finger mode used for mobile drag */
  .bowl.drag-follow {
    position: fixed !important;
    left: 0; top: 0;
    transform: translate(0,0) !important;
    z-index: 10000;
  }

  .woof{
    position:absolute; top:8%; left:58%;
    background:#fff; border-radius:999px; padding:6px 10px; box-shadow: var(--shadow);
    font-weight:800; transform: scale(0) rotate(-8deg); transform-origin:left bottom;
    transition: transform .2s ease;
  }

  @media (prefers-reduced-motion: reduce){
    .wag{ animation-duration: 1.6s }
    .returning{ transition-duration:.2s }
  }
  .sr-only{
    position:absolute!important; width:1px!important; height:1px!important; padding:0!important; margin:-1px!important; overflow:hidden!important; clip:rect(0,0,0,0)!important; white-space:nowrap!important; border:0!important;
  }
</style>
</head>
<body>
<div class="wrap" role="application" aria-label="Penuki‚Äîpuppy care game">
  <header class="hud">
    <div class="title-row">
      <div class="logo" aria-hidden="true">üêæ</div>
      <h1>Penuki</h1>
      <div class="sub">Keep the puppy happy: feed, play, and pet!</div>
    </div>

    <!-- Scores auto-wrap; words auto-hide on very narrow phones -->
    <div class="scores" aria-live="polite">
      <div class="card" id="score-feed" aria-label="Feed score">
        <div class="row">
          <span class="tag"><span class="em">üç™</span><span class="label"> Feed</span></span>
          <span class="num">10</span>
        </div>
        <div class="bar" aria-hidden="true"><div class="fill feed" style="--p:100"></div></div>
      </div>
      <div class="card" id="score-play" aria-label="Play score">
        <div class="row">
          <span class="tag"><span class="em">üéæ</span><span class="label"> Play</span></span>
          <span class="num">10</span>
        </div>
        <div class="bar" aria-hidden="true"><div class="fill play" style="--p:100"></div></div>
      </div>
      <div class="card" id="score-pet" aria-label="Pet score">
        <div class="row">
          <span class="tag"><span class="em">üíñ</span><span class="label"> Pet</span></span>
          <span class="num">10</span>
        </div>
        <div class="bar" aria-hidden="true"><div class="fill pet" style="--p:100"></div></div>
      </div>
      <div class="card" id="score-avg" aria-label="Happiness score">
        <div class="row">
          <span class="tag"><span class="em">üòä</span><span class="label"> Happy</span></span>
          <span class="num">10</span>
        </div>
        <div class="bar" aria-hidden="true"><div class="fill avg" style="--p:100"></div></div>
      </div>
    </div>
  </header>

  <main class="stage">
    <div class="stage-inner" id="stage">
      <div class="moodTint" id="moodTint"></div>
      <div class="puppy-wrap">
        <!-- Cute SVG Puppy -->
        <svg id="puppySVG" viewBox="0 0 400 260" aria-labelledby="puppyTitle puppyDesc" role="img">
          <title id="puppyTitle">Penuki the puppy</title>
          <desc id="puppyDesc">A cute cartoon puppy whose expression changes with happiness.</desc>

          <defs>
            <radialGradient id="fur" cx="50%" cy="40%" r="70%">
              <stop offset="0%" stop-color="#fff4e6"/>
              <stop offset="100%" stop-color="#f2c99c"/>
            </radialGradient>
            <radialGradient id="ear" cx="50%" cy="40%" r="70%">
              <stop offset="0%" stop-color="#e6b182"/>
              <stop offset="100%" stop-color="#b67f56"/>
            </radialGradient>
            <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
              <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#000" flood-opacity=".25"/>
            </filter>
          </defs>

          <!-- Ground shadow -->
          <ellipse cx="200" cy="240" rx="90" ry="15" fill="#00000010"/>

          <!-- TAIL (moved & attached to body edge) -->
          <g class="tail wag" style="--wag:.9s" transform="translate(295,188)">
            <!-- base that overlaps the body so it looks connected -->
            <circle cx="0" cy="0" r="9" fill="url(#ear)"/>
            <!-- tail -->
            <rect x="0" y="-6" width="60" height="12" rx="6" fill="#b67f56"/>
            <circle cx="60" cy="0" r="8" fill="#b67f56"/>
          </g>

          <!-- Body -->
          <ellipse cx="200" cy="188" rx="95" ry="58" fill="url(#fur)" filter="url(#shadow)"/>

          <!-- Head -->
          <g id="head" transform="translate(0,0)">
            <!-- Ears -->
            <g id="ears">
              <ellipse cx="130" cy="85" rx="26" ry="44" fill="url(#ear)" transform="rotate(-18 130 85)"/>
              <ellipse cx="270" cy="85" rx="26" ry="44" fill="url(#ear)" transform="rotate(18 270 85)"/>
            </g>

            <!-- Head circle -->
            <circle cx="200" cy="120" r="80" fill="url(#fur)" filter="url(#shadow)"/>

            <!-- Eye spots -->
            <ellipse cx="168" cy="110" rx="22" ry="18" fill="#ffffffa0"/>
            <ellipse cx="232" cy="110" rx="22" ry="18" fill="#ffffffa0"/>

            <!-- Eyes -->
            <g id="eyes">
              <g id="eyeL">
                <circle cx="168" cy="110" r="9" fill="#2b1d1b"/>
                <circle cx="165" cy="107" r="3.5" fill="#fff"/>
              </g>
              <g id="eyeR">
                <circle cx="232" cy="110" r="9" fill="#2b1d1b"/>
                <circle cx="229" cy="107" r="3.5" fill="#fff"/>
              </g>
            </g>

            <!-- Nose -->
            <g id="nose" transform="translate(0,10)">
              <ellipse cx="200" cy="130" rx="14" ry="10" fill="#2b1d1b"/>
            </g>

            <!-- Mouth variants -->
            <g id="mouth">
              <path id="mouth-happy" d="M170,148 Q200,168 230,148" stroke="#2b1d1b" stroke-width="5" fill="none" stroke-linecap="round" />
              <path id="mouth-neutral" d="M170,152 Q200,152 230,152" stroke="#2b1d1b" stroke-width="5" fill="none" stroke-linecap="round" opacity="0"/>
              <path id="mouth-sad" d="M170,160 Q200,140 230,160" stroke="#2b1d1b" stroke-width="5" fill="none" stroke-linecap="round" opacity="0"/>
            </g>

            <!-- Tongue -->
            <path id="tongue" d="M196,154 q4,18 8,0" stroke="none" fill="#ff7e8a" opacity="0"/>

            <!-- Interaction target -->
            <circle id="hitTarget" cx="200" cy="145" r="40" fill="transparent" />
          </g>
        </svg>
        <div class="woof" id="woof">woof!</div>
      </div>
    </div>
  </main>

  <section class="controls" aria-label="Controls">
    <div class="pad-grid">
      <!-- FEED -->
      <div class="pad" id="feedPad">
        <h3>üç™ Feed</h3>
        <div class="hint">Press the bowl, slide it to the puppy‚Äôs face, or just tap the bowl for a quick snack.</div>
        <div class="playground">
          <div class="bowl float" id="bowl" role="button" aria-label="Bowl of treats; drag to feed" tabindex="0" style="transform:translate(0px,0px)">
            <svg viewBox="0 0 140 90" width="120" height="78" aria-hidden="true">
              <defs>
                <linearGradient id="bgrad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stop-color="#ffb3d0"/>
                  <stop offset="100%" stop-color="#ff6b9e"/>
                </linearGradient>
              </defs>
              <g>
                <circle cx="40" cy="20" r="10" fill="#d49a6a"/>
                <circle cx="60" cy="18" r="9"  fill="#c9895a"/>
                <circle cx="80" cy="22" r="11" fill="#d49a6a"/>
                <circle cx="100" cy="18" r="9" fill="#c9895a"/>
              </g>
              <ellipse cx="70" cy="65" rx="58" ry="20" fill="#00000018"/>
              <path d="M20,40 h100 a6,6 0 0 1 6,6 v20 a24,24 0 0 1 -24,24 h-64 a24,24 0 0 1 -24,-24 v-20 a6,6 0 0 1 6,-6z" fill="url(#bgrad)"/>
              <ellipse cx="70" cy="42" rx="50" ry="12" fill="#ffc2da" stroke="#ff7bb2" stroke-width="3"/>
              <text x="70" y="73" text-anchor="middle" font-size="16" font-weight="800" fill="#fff">YUM</text>
            </svg>
          </div>
        </div>
      </div>

      <!-- PLAY -->
      <div class="pad" id="playPad">
        <h3>üéæ Play</h3>
        <div class="hint">Tap the ball to throw it.</div>
        <div class="playground">
          <div class="ball float" id="ball" role="button" aria-label="Throw tennis ball" tabindex="0">
            <svg viewBox="0 0 90 90" width="80" height="80" aria-hidden="true">
              <defs>
                <radialGradient id="gBall" cx="35%" cy="30%" r="70%">
                  <stop offset="0%" stop-color="#fffde0"/>
                  <stop offset="100%" stop-color="#a9ff37"/>
                </radialGradient>
              </defs>
              <circle cx="45" cy="45" r="40" fill="url(#gBall)" stroke="#7bd32a" stroke-width="6"/>
              <path d="M10,36 q35,-20 70,0" stroke="#fff" stroke-width="6" fill="none"/>
              <path d="M10,54 q35,20 70,0"  stroke="#fff" stroke-width="6" fill="none"/>
            </svg>
          </div>
        </div>
      </div>

      <!-- PET -->
      <div class="pad" id="petPad">
        <h3>üíñ Pet</h3>
        <div class="hint">Tap to send hearts.</div>
        <div class="playground">
          <button class="heart-btn" id="heartBtn" aria-label="Send hearts" style="background:none;border:0">
            <svg viewBox="0 0 120 90" width="120" height="80" aria-hidden="true">
              <defs>
                <linearGradient id="hgrad" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stop-color="#ff8ac5"/>
                  <stop offset="100%" stop-color="#ff4d8d"/>
                </linearGradient>
              </defs>
              <path d="M60 80 C 20 55, 5 40, 20 25 C 35 10, 55 20, 60 35 C 65 20, 85 10, 100 25 C 115 40, 100 55, 60 80 Z" fill="url(#hgrad)" filter="url(#shadow)"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
    <p class="sr-only" id="instructions">
      Keep feed, play, and pet scores high. Each slowly ticks down at random times. Drag the bowl onto the puppy to feed
      (press and slide). A quick tap on the bowl also feeds. Tap the ball to throw it. Tap the hearts to give affection.
    </p>
  </section>
</div>

<script>
(() => {
  const clamp=(min,v,max)=>Math.max(min,Math.min(max,v));
  const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;

  const scores = { feed:10, play:10, pet:10 };
  const els = {
    feed: document.querySelector('#score-feed'),
    play: document.querySelector('#score-play'),
    pet:  document.querySelector('#score-pet'),
    avg:  document.querySelector('#score-avg'),
    stage: document.getElementById('stage'),
    puppy: document.getElementById('puppySVG'),
    hit: document.getElementById('hitTarget'),
    mouthHappy: document.getElementById('mouth-happy'),
    mouthNeutral: document.getElementById('mouth-neutral'),
    mouthSad: document.getElementById('mouth-sad'),
    tongue: document.getElementById('tongue'),
    tail: document.querySelector('.tail'),
    moodTint: document.getElementById('moodTint'),
    woof: document.getElementById('woof'),
    bowl: document.getElementById('bowl'),
    ball: document.getElementById('ball'),
    heartBtn: document.getElementById('heartBtn'),
  };

  function updateBars(){
    const set = (key,val)=>{
      const c = els[key];
      c.querySelector('.num').textContent = String(val);
      c.querySelector('.fill').style.setProperty('--p', val*10);
      c.setAttribute('aria-label', `${key==='avg'?'Happiness':key} score ${val} out of 10`);
    };
    set('feed', scores.feed);
    set('play', scores.play);
    set('pet',  scores.pet);
    const avg = Math.round((scores.feed + scores.play + scores.pet)/3);
    set('avg', avg);
    applyMood(avg/10);
  }

  function applyMood(m){
    if(m>0.66){
      els.mouthHappy.setAttribute('opacity','1');
      els.mouthNeutral.setAttribute('opacity','0');
      els.mouthSad.setAttribute('opacity','0');
    }else if(m>0.33){
      els.mouthHappy.setAttribute('opacity','0');
      els.mouthNeutral.setAttribute('opacity','1');
      els.mouthSad.setAttribute('opacity','0');
    }else{
      els.mouthHappy.setAttribute('opacity','0');
      els.mouthNeutral.setAttribute('opacity','0');
      els.mouthSad.setAttribute('opacity','1');
    }

    const sparkle = clamp(2, 2 + m*3.5, 5.5);
    document.querySelectorAll('#eyeL circle:nth-child(2), #eyeR circle:nth-child(2)')
      .forEach(s=>s.setAttribute('r', sparkle.toFixed(1)));

    const earL = els.puppy.querySelector('ellipse[cx="130"]');
    const earR = els.puppy.querySelector('ellipse[cx="270"]');
    const droop = (1-m)*20;
    earL.setAttribute('transform', `rotate(${-18 - droop} 130 85)`);
    earR.setAttribute('transform', `rotate(${18 + droop} 270 85)`);

    const speed = clamp(.25, 1.2 - m, 1.2);
    els.tail.style.setProperty('--wag', `${speed.toFixed(2)}s`);

    els.moodTint.style.opacity = (1-m)*0.35;
  }

  function bumpScore(key, amount=2){
    scores[key] = clamp(0, scores[key] + amount, 10);
    if(key==='feed'){ flashTongue(); }
    if(key==='play'){ bark(); }
    if(key==='pet'){ spawnHeartsToward(3); }
    updateBars();
  }

  function scheduleDecay(key){
    const delay = rand(1000,10000);
    setTimeout(()=>{
      if(scores[key] > 0){
        scores[key] -= 1;
        updateBars();
      }
      scheduleDecay(key);
    }, delay);
  }

  // Puppy reactions
  let tongueTimeout;
  function flashTongue(){
    clearTimeout(tongueTimeout);
    els.tongue.setAttribute('opacity','1');
    tongueTimeout = setTimeout(()=>els.tongue.setAttribute('opacity','0'), 800);
  }
  let woofTimer;
  function bark(){
    clearTimeout(woofTimer);
    els.woof.style.transform = 'scale(1) rotate(-8deg)';
    woofTimer = setTimeout(()=>{ els.woof.style.transform='scale(0) rotate(-8deg)'; }, 600);
  }

  // Coords utilities
  const getXY = (e) => (e.touches && e.touches.length)
    ? { x: e.touches[0].clientX, y: e.touches[0].clientY }
    : { x: e.clientX, y: e.clientY };
  const safePrevent = (e) => { if (e && e.cancelable) e.preventDefault(); };

  // FEED: robust mobile drag
  (function initBowl(){
    const bowl = els.bowl;
    const hit = els.hit;
    const homeTransform = 'translate(0px, 0px)';
    let dragging = false;
    let startOffset = {x:0,y:0};
    let startXY = {x:0,y:0};

    function placeAtViewport(x, y){
      bowl.style.left = (x - startOffset.x) + 'px';
      bowl.style.top  = (y - startOffset.y) + 'px';
    }
    function beginDrag(e){
      dragging = true;
      bowl.classList.add('dragging','drag-follow');
      bowl.classList.remove('returning');
      const rect = bowl.getBoundingClientRect();
      const p = getXY(e);
      startOffset.x = p.x - rect.left;
      startOffset.y = p.y - rect.top;
      startXY = {x:p.x, y:p.y};
      placeAtViewport(p.x, p.y);
    }
    function moveDrag(e){ if(!dragging) return; safePrevent(e); const p=getXY(e); placeAtViewport(p.x,p.y); }
    function overPuppy(){
      const a=bowl.getBoundingClientRect(), b=hit.getBoundingClientRect();
      return !(a.right<b.left || a.left>b.right || a.bottom<b.top || a.top>b.bottom);
    }
    function endDrag(e){
      const p = getXY(e);
      const dist = Math.hypot(p.x - startXY.x, p.y - startXY.y);
      const quickTap = dist < 12;

      bowl.classList.remove('drag-follow','dragging');
      dragging = false;

      if (overPuppy() || quickTap){ bumpScore('feed',2); flashTongue(); }
      bowl.classList.add('returning');
      bowl.style.left=''; bowl.style.top=''; bowl.style.transform=homeTransform;
      setTimeout(()=>bowl.classList.remove('returning'), 520);
    }

    if ('PointerEvent' in window){
      bowl.addEventListener('pointerdown', (e)=>{ if(e.button!==0 && e.pointerType!=='touch') return; safePrevent(e); try{ bowl.setPointerCapture(e.pointerId); }catch{} beginDrag(e); }, {passive:false});
      window.addEventListener('pointermove', (e)=>moveDrag(e), {passive:false});
      window.addEventListener('pointerup',   (e)=>{ try{ bowl.releasePointerCapture(e.pointerId); }catch{} endDrag(e); }, {passive:false});
      window.addEventListener('pointercancel',(e)=>endDrag(e), {passive:false});
    }else{
      bowl.addEventListener('touchstart', (e)=>{ safePrevent(e); beginDrag(e); }, {passive:false});
      window.addEventListener('touchmove',  (e)=>moveDrag(e), {passive:false});
      window.addEventListener('touchend',   (e)=>endDrag(e), {passive:false});
      window.addEventListener('touchcancel',(e)=>endDrag(e), {passive:false});
    }

    bowl.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' || e.key===' '){ e.preventDefault(); bumpScore('feed',2); flashTongue(); }
    });
  })();

  // PLAY (throw ball)
  (function initBall(){
    const ball = els.ball;
    const home = {x:0,y:0};
    ball.style.transform = `translate(${home.x}px, ${home.y}px)`;
    function throwBall(){
      const target = els.hit.getBoundingClientRect();
      const r = ball.getBoundingClientRect();
      const tx = (target.left + target.width/2) - (r.left + r.width/2);
      const ty = (target.top + target.height/2) - (r.top + r.height/2);
      const keyframes = [
        { transform: `translate(${home.x}px, ${home.y}px)` },
        { offset:.5, transform: `translate(${home.x + tx*0.5}px, ${home.y + ty*0.5 - 120}px)` },
        { transform: `translate(${home.x + tx}px, ${home.y + ty}px)` },
      ];
      const anim = ball.animate(keyframes, { duration: 650, easing: 'cubic-bezier(.16,1,.3,1)' });
      anim.onfinish = ()=>{
        bumpScore('play',2);
        ball.classList.add('returning');
        ball.style.transform = `translate(${home.x}px, ${home.y}px)`;
        setTimeout(()=>ball.classList.remove('returning'), 520);
      };
    }
    ball.addEventListener('click', throwBall);
    ball.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); throwBall(); }});
  })();

  // PET (hearts)
  function spawnHeartsToward(n=6){
    const btnRect = els.heartBtn.getBoundingClientRect();
    const target = els.hit.getBoundingClientRect();
    for(let i=0;i<n;i++){
      const h = document.createElement('div');
      h.className='float'; h.style.pointerEvents='none';
      h.innerHTML = `<svg viewBox="0 0 24 22" width="24" height="22" aria-hidden="true">
        <path d="M12 21 C 3 13,1 9,4 6 C 7 3,11 5,12 8 C 13 5,17 3,20 6 C 23 9,21 13,12 21 Z" fill="#ff5fa2"/>
      </svg>`;
      document.body.appendChild(h);
      const sx = btnRect.left + btnRect.width/2 + (Math.random()*60-30);
      const sy = btnRect.top + (Math.random()*20-10);
      const ex = target.left + target.width/2 + (Math.random()*20-10);
      const ey = target.top + target.height/2 + (Math.random()*20-10);
      const cx = (sx+ex)/2 + (Math.random()*160-80);
      const cy = Math.min(sy,ey) - (60+Math.random()*80);
      const dur = 600 + Math.random()*300;
      let t0=null;
      function step(t){
        if(!t0) t0=t;
        const p=Math.min(1,(t-t0)/dur);
        const x=(1-p)*(1-p)*sx + 2*(1-p)*p*cx + p*p*ex;
        const y=(1-p)*(1-p)*sy + 2*(1-p)*p*cy + p*p*ey;
        h.style.transform=`translate(${x}px, ${y}px) scale(${0.7+p*0.5}) rotate(${(p*180)|0}deg)`;
        if(p<1) requestAnimationFrame(step); else h.remove();
      }
      requestAnimationFrame(step);
    }
  }
  els.heartBtn.addEventListener('click', ()=>bumpScore('pet',2));

  // Start decays & set initial mood
  ['feed','play','pet'].forEach(scheduleDecay);
  updateBars();

  // Bonus tap on stage to pet
  els.stage.addEventListener('click', (e)=>{
    const path = e.composedPath ? e.composedPath() : [];
    if(path.includes(els.bowl) || path.includes(els.ball) || path.includes(els.heartBtn)) return;
    const t = els.hit.getBoundingClientRect();
    if(e.clientY >= t.top-80 && e.clientY <= t.bottom+80){ bumpScore('pet',1); }
  });
})();
</script>
</body>
</html>